import{r as L}from"./bn.js-BkBmvZSs.js";import{r as j}from"./safe-buffer-PaMJ6TrP.js";import{r as W}from"./text-encoding-utf-8-HRA9QLhT.js";var a={},M,q;function G(){if(q)return M;q=1;var z=j().Buffer;function R(d){if(d.length>=255)throw new TypeError("Alphabet too long");for(var E=new Uint8Array(256),A=0;A<E.length;A++)E[A]=255;for(var g=0;g<d.length;g++){var m=d.charAt(g),F=m.charCodeAt(0);if(E[F]!==255)throw new TypeError(m+" is ambiguous");E[F]=g}var _=d.length,S=d.charAt(0),O=Math.log(_)/Math.log(256),D=Math.log(256)/Math.log(_);function x(f){if((Array.isArray(f)||f instanceof Uint8Array)&&(f=z.from(f)),!z.isBuffer(f))throw new TypeError("Expected Buffer");if(f.length===0)return"";for(var s=0,v=0,u=0,b=f.length;u!==b&&f[u]===0;)u++,s++;for(var U=(b-u)*D+1>>>0,w=new Uint8Array(U);u!==b;){for(var c=f[u],B=0,p=U-1;(c!==0||B<v)&&p!==-1;p--,B++)c+=256*w[p]>>>0,w[p]=c%_>>>0,c=c/_>>>0;if(c!==0)throw new Error("Non-zero carry");v=B,u++}for(var t=U-v;t!==U&&w[t]===0;)t++;for(var e=S.repeat(s);t<U;++t)e+=d.charAt(w[t]);return e}function l(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return z.alloc(0);for(var s=0,v=0,u=0;f[s]===S;)v++,s++;for(var b=(f.length-s)*O+1>>>0,U=new Uint8Array(b);s<f.length;){var w=f.charCodeAt(s);if(w>255)return;var c=E[w];if(c===255)return;for(var B=0,p=b-1;(c!==0||B<u)&&p!==-1;p--,B++)c+=_*U[p]>>>0,U[p]=c%256>>>0,c=c/256>>>0;if(c!==0)throw new Error("Non-zero carry");u=B,s++}for(var t=b-u;t!==b&&U[t]===0;)t++;var e=z.allocUnsafe(v+(b-t));e.fill(0,0,v);for(var r=v;t!==b;)e[r++]=U[t++];return e}function $(f){var s=l(f);if(s)return s;throw new Error("Non-base"+_+" character")}return{encode:x,decodeUnsafe:l,decode:$}}return M=R,M}var k,P;function K(){if(P)return k;P=1;var z=G(),R="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";return k=z(R),k}var I;function N(){if(I)return a;I=1;var z=a&&a.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),R=a&&a.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),d=a&&a.__decorate||function(t,e,r,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,n);else for(var y=t.length-1;y>=0;y--)(h=t[y])&&(o=(i<3?h(o):i>3?h(e,r,o):h(e,r))||o);return i>3&&o&&Object.defineProperty(e,r,o),o},E=a&&a.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.hasOwnProperty.call(t,r)&&z(e,t,r);return R(e,t),e},A=a&&a.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(a,"__esModule",{value:!0}),a.deserializeUnchecked=a.deserialize=a.serialize=a.BinaryReader=a.BinaryWriter=a.BorshError=a.baseDecode=a.baseEncode=void 0;const g=A(L()),m=A(K()),F=E(W),_=typeof TextDecoder!="function"?F.TextDecoder:TextDecoder,S=new _("utf-8",{fatal:!0});function O(t){return typeof t=="string"&&(t=Buffer.from(t,"utf8")),m.default.encode(Buffer.from(t))}a.baseEncode=O;function D(t){return Buffer.from(m.default.decode(t))}a.baseDecode=D;const x=1024;class l extends Error{constructor(e){super(e),this.fieldPath=[],this.originalMessage=e}addToFieldPath(e){this.fieldPath.splice(0,0,e),this.message=this.originalMessage+": "+this.fieldPath.join(".")}}a.BorshError=l;class ${constructor(){this.buf=Buffer.alloc(x),this.length=0}maybeResize(){this.buf.length<16+this.length&&(this.buf=Buffer.concat([this.buf,Buffer.alloc(x)]))}writeU8(e){this.maybeResize(),this.buf.writeUInt8(e,this.length),this.length+=1}writeU16(e){this.maybeResize(),this.buf.writeUInt16LE(e,this.length),this.length+=2}writeU32(e){this.maybeResize(),this.buf.writeUInt32LE(e,this.length),this.length+=4}writeU64(e){this.maybeResize(),this.writeBuffer(Buffer.from(new g.default(e).toArray("le",8)))}writeU128(e){this.maybeResize(),this.writeBuffer(Buffer.from(new g.default(e).toArray("le",16)))}writeU256(e){this.maybeResize(),this.writeBuffer(Buffer.from(new g.default(e).toArray("le",32)))}writeU512(e){this.maybeResize(),this.writeBuffer(Buffer.from(new g.default(e).toArray("le",64)))}writeBuffer(e){this.buf=Buffer.concat([Buffer.from(this.buf.subarray(0,this.length)),e,Buffer.alloc(x)]),this.length+=e.length}writeString(e){this.maybeResize();const r=Buffer.from(e,"utf8");this.writeU32(r.length),this.writeBuffer(r)}writeFixedArray(e){this.writeBuffer(Buffer.from(e))}writeArray(e,r){this.maybeResize(),this.writeU32(e.length);for(const n of e)this.maybeResize(),r(n)}toArray(){return this.buf.subarray(0,this.length)}}a.BinaryWriter=$;function f(t,e,r){const n=r.value;r.value=function(...i){try{return n.apply(this,i)}catch(o){if(o instanceof RangeError){const h=o.code;if(["ERR_BUFFER_OUT_OF_BOUNDS","ERR_OUT_OF_RANGE"].indexOf(h)>=0)throw new l("Reached the end of buffer when deserializing")}throw o}}}class s{constructor(e){this.buf=e,this.offset=0}readU8(){const e=this.buf.readUInt8(this.offset);return this.offset+=1,e}readU16(){const e=this.buf.readUInt16LE(this.offset);return this.offset+=2,e}readU32(){const e=this.buf.readUInt32LE(this.offset);return this.offset+=4,e}readU64(){const e=this.readBuffer(8);return new g.default(e,"le")}readU128(){const e=this.readBuffer(16);return new g.default(e,"le")}readU256(){const e=this.readBuffer(32);return new g.default(e,"le")}readU512(){const e=this.readBuffer(64);return new g.default(e,"le")}readBuffer(e){if(this.offset+e>this.buf.length)throw new l(`Expected buffer length ${e} isn't within bounds`);const r=this.buf.slice(this.offset,this.offset+e);return this.offset+=e,r}readString(){const e=this.readU32(),r=this.readBuffer(e);try{return S.decode(r)}catch(n){throw new l(`Error decoding UTF-8 string: ${n}`)}}readFixedArray(e){return new Uint8Array(this.readBuffer(e))}readArray(e){const r=this.readU32(),n=Array();for(let i=0;i<r;++i)n.push(e());return n}}d([f],s.prototype,"readU8",null),d([f],s.prototype,"readU16",null),d([f],s.prototype,"readU32",null),d([f],s.prototype,"readU64",null),d([f],s.prototype,"readU128",null),d([f],s.prototype,"readU256",null),d([f],s.prototype,"readU512",null),d([f],s.prototype,"readString",null),d([f],s.prototype,"readFixedArray",null),d([f],s.prototype,"readArray",null),a.BinaryReader=s;function v(t){return t.charAt(0).toUpperCase()+t.slice(1)}function u(t,e,r,n,i){try{if(typeof n=="string")i[`write${v(n)}`](r);else if(n instanceof Array)if(typeof n[0]=="number"){if(r.length!==n[0])throw new l(`Expecting byte array of length ${n[0]}, but got ${r.length} bytes`);i.writeFixedArray(r)}else if(n.length===2&&typeof n[1]=="number"){if(r.length!==n[1])throw new l(`Expecting byte array of length ${n[1]}, but got ${r.length} bytes`);for(let o=0;o<n[1];o++)u(t,null,r[o],n[0],i)}else i.writeArray(r,o=>{u(t,e,o,n[0],i)});else if(n.kind!==void 0)switch(n.kind){case"option":{r==null?i.writeU8(0):(i.writeU8(1),u(t,e,r,n.type,i));break}case"map":{i.writeU32(r.size),r.forEach((o,h)=>{u(t,e,h,n.key,i),u(t,e,o,n.value,i)});break}default:throw new l(`FieldType ${n} unrecognized`)}else b(t,r,i)}catch(o){throw o instanceof l&&o.addToFieldPath(e),o}}function b(t,e,r){if(typeof e.borshSerialize=="function"){e.borshSerialize(r);return}const n=t.get(e.constructor);if(!n)throw new l(`Class ${e.constructor.name} is missing in schema`);if(n.kind==="struct")n.fields.map(([i,o])=>{u(t,i,e[i],o,r)});else if(n.kind==="enum"){const i=e[n.field];for(let o=0;o<n.values.length;++o){const[h,y]=n.values[o];if(h===i){r.writeU8(o),u(t,h,e[h],y,r);break}}}else throw new l(`Unexpected schema kind: ${n.kind} for ${e.constructor.name}`)}function U(t,e,r=$){const n=new r;return b(t,e,n),n.toArray()}a.serialize=U;function w(t,e,r,n){try{if(typeof r=="string")return n[`read${v(r)}`]();if(r instanceof Array){if(typeof r[0]=="number")return n.readFixedArray(r[0]);if(typeof r[1]=="number"){const i=[];for(let o=0;o<r[1];o++)i.push(w(t,null,r[0],n));return i}else return n.readArray(()=>w(t,e,r[0],n))}if(r.kind==="option")return n.readU8()?w(t,e,r.type,n):void 0;if(r.kind==="map"){let i=new Map;const o=n.readU32();for(let h=0;h<o;h++){const y=w(t,e,r.key,n),C=w(t,e,r.value,n);i.set(y,C)}return i}return c(t,r,n)}catch(i){throw i instanceof l&&i.addToFieldPath(e),i}}function c(t,e,r){if(typeof e.borshDeserialize=="function")return e.borshDeserialize(r);const n=t.get(e);if(!n)throw new l(`Class ${e.name} is missing in schema`);if(n.kind==="struct"){const i={};for(const[o,h]of t.get(e).fields)i[o]=w(t,o,h,r);return new e(i)}if(n.kind==="enum"){const i=r.readU8();if(i>=n.values.length)throw new l(`Enum index: ${i} is out of range`);const[o,h]=n.values[i],y=w(t,o,h,r);return new e({[o]:y})}throw new l(`Unexpected schema kind: ${n.kind} for ${e.constructor.name}`)}function B(t,e,r,n=s){const i=new n(r),o=c(t,e,i);if(i.offset<r.length)throw new l(`Unexpected ${r.length-i.offset} bytes after deserialized data`);return o}a.deserialize=B;function p(t,e,r,n=s){const i=new n(r);return c(t,e,i)}return a.deserializeUnchecked=p,a}var X=N();export{X as l};
