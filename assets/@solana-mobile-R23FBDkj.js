import{c as ye,V as fe,T as ge,a as _e,S as pe,B as me,W as p,b as ve,d as we,P as be,e as x,f as z,g as Re,h as Ee,i as Se,j as Oe}from"./@solana-CKixXqEH.js";import{b as Ae}from"./bs58-DGbdKtE6.js";import"./qrcode-D9Rb481l.js";const b={ERROR_ASSOCIATION_PORT_OUT_OF_RANGE:"ERROR_ASSOCIATION_PORT_OUT_OF_RANGE",ERROR_FORBIDDEN_WALLET_BASE_URL:"ERROR_FORBIDDEN_WALLET_BASE_URL",ERROR_SECURE_CONTEXT_REQUIRED:"ERROR_SECURE_CONTEXT_REQUIRED",ERROR_SESSION_CLOSED:"ERROR_SESSION_CLOSED",ERROR_SESSION_TIMEOUT:"ERROR_SESSION_TIMEOUT",ERROR_WALLET_NOT_FOUND:"ERROR_WALLET_NOT_FOUND",ERROR_INVALID_PROTOCOL_VERSION:"ERROR_INVALID_PROTOCOL_VERSION"};class R extends Error{constructor(...e){const[n,t,s]=e;super(t),this.code=n,this.data=s,this.name="SolanaMobileWalletAdapterError"}}class oe extends Error{constructor(...e){const[n,t,s,o]=e;super(s),this.code=t,this.data=o,this.jsonRpcMessageId=n,this.name="SolanaMobileWalletAdapterProtocolError"}}function f(i,e,n,t){function s(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function a(l){try{d(t.next(l))}catch(c){r(c)}}function y(l){try{d(t.throw(l))}catch(c){r(c)}}function d(l){l.done?o(l.value):s(l.value).then(a,y)}d((t=t.apply(i,[])).next())})}function k(i,e){return f(this,void 0,void 0,function*(){const n=yield crypto.subtle.exportKey("raw",i),t=yield crypto.subtle.sign({hash:"SHA-256",name:"ECDSA"},e,n),s=new Uint8Array(n.byteLength+t.byteLength);return s.set(new Uint8Array(n),0),s.set(new Uint8Array(t),n.byteLength),s})}function Te(i){return window.btoa(i)}function Ie(i){return ye(i)}function Ce(i){return Te(Ie(i))}const Le="solana:signTransactions",X="solana:cloneAuthorization";function Ne(i,e){return new Proxy({},{get(n,t){return n[t]==null&&(n[t]=function(s){return f(this,void 0,void 0,function*(){const{method:o,params:r}=Me(t,s,i),a=yield e(o,r);return o==="authorize"&&r.sign_in_payload&&!a.sign_in_result&&(a.sign_in_result=yield Ue(r.sign_in_payload,a,e)),Pe(t,a,i)})}),n[t]},defineProperty(){return!1},deleteProperty(){return!1}})}function Me(i,e,n){let t=e,s=i.toString().replace(/[A-Z]/g,o=>`_${o.toLowerCase()}`).toLowerCase();switch(i){case"authorize":{let{chain:o}=t;if(n==="legacy"){switch(o){case"solana:testnet":{o="testnet";break}case"solana:devnet":{o="devnet";break}case"solana:mainnet":{o="mainnet-beta";break}default:o=t.cluster}t.cluster=o}else{switch(o){case"testnet":case"devnet":{o=`solana:${o}`;break}case"mainnet-beta":{o="solana:mainnet";break}}t.chain=o}}case"reauthorize":{const{auth_token:o,identity:r}=t;if(o)switch(n){case"legacy":{s="reauthorize",t={auth_token:o,identity:r};break}default:{s="authorize";break}}break}}return{method:s,params:t}}function Pe(i,e,n){switch(i){case"getCapabilities":{const t=e;switch(n){case"legacy":{const s=[Le];return t.supports_clone_authorization===!0&&s.push(X),Object.assign(Object.assign({},t),{features:s})}case"v1":return Object.assign(Object.assign({},t),{supports_sign_and_send_transactions:!0,supports_clone_authorization:t.features.includes(X)})}}}return e}function Ue(i,e,n){var t;return f(this,void 0,void 0,function*(){const s=(t=i.domain)!==null&&t!==void 0?t:window.location.host,o=e.accounts[0].address,r=Ce(Object.assign(Object.assign({},i),{domain:s,address:o})),a=yield n("sign_messages",{addresses:[o],payloads:[r]});return{address:o,signed_message:r,signature:a.signed_payloads[0].slice(r.length)}})}const O=4;function ze(i){if(i>=4294967296)throw new Error("Outbound sequence number overflow. The maximum sequence number is 32-bytes.");const e=new ArrayBuffer(O);return new DataView(e).setUint32(0,i,!1),new Uint8Array(e)}const Y=12,re=65;function je(i,e,n){return f(this,void 0,void 0,function*(){const t=ze(e),s=new Uint8Array(Y);crypto.getRandomValues(s);const o=yield crypto.subtle.encrypt(ce(t,s),n,new TextEncoder().encode(i)),r=new Uint8Array(t.byteLength+s.byteLength+o.byteLength);return r.set(new Uint8Array(t),0),r.set(new Uint8Array(s),t.byteLength),r.set(new Uint8Array(o),t.byteLength+s.byteLength),r})}function ae(i,e){return f(this,void 0,void 0,function*(){const n=i.slice(0,O),t=i.slice(O,O+Y),s=i.slice(O+Y),o=yield crypto.subtle.decrypt(ce(n,t),e,s);return Ke().decode(o)})}function ce(i,e){return{additionalData:i,iv:e,name:"AES-GCM",tagLength:128}}let B;function Ke(){return B===void 0&&(B=new TextDecoder("utf-8")),B}function We(){return f(this,void 0,void 0,function*(){return yield crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!1,["sign"])})}function F(){return f(this,void 0,void 0,function*(){return yield crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!1,["deriveKey","deriveBits"])})}function De(i,e){return f(this,void 0,void 0,function*(){const n=JSON.stringify(i),t=i.id;return je(n,t,e)})}function xe(i,e){return f(this,void 0,void 0,function*(){const n=yield ae(i,e),t=JSON.parse(n);if(Object.hasOwnProperty.call(t,"error"))throw new oe(t.id,t.error.code,t.error.message);return t})}function ke(i,e,n){return f(this,void 0,void 0,function*(){const[t,s]=yield Promise.all([crypto.subtle.exportKey("raw",e),crypto.subtle.importKey("raw",i.slice(0,re),{name:"ECDH",namedCurve:"P-256"},!1,[])]),o=yield crypto.subtle.deriveBits({name:"ECDH",public:s},n,256),r=yield crypto.subtle.importKey("raw",o,"HKDF",!1,["deriveKey"]);return yield crypto.subtle.deriveKey({name:"HKDF",hash:"SHA-256",salt:new Uint8Array(t),info:new Uint8Array},r,{name:"AES-GCM",length:128},!1,["encrypt","decrypt"])})}function Be(i,e){return f(this,void 0,void 0,function*(){const n=yield ae(i,e),t=JSON.parse(n);let s="legacy";if(Object.hasOwnProperty.call(t,"v"))switch(t.v){case 1:case"1":case"v1":s="v1";break;case"legacy":s="legacy";break;default:throw new R(b.ERROR_INVALID_PROTOCOL_VERSION,`Unknown/unsupported protocol version: ${t.v}`)}return{protocol_version:s}})}function Fe(){return le(49152+Math.floor(Math.random()*16384))}function le(i){if(i<49152||i>65535)throw new R(b.ERROR_ASSOCIATION_PORT_OUT_OF_RANGE,`Association port number must be between 49152 and 65535. ${i} given.`,{port:i});return i}function Ge(i){let e="";const n=new Uint8Array(i),t=n.byteLength;for(let s=0;s<t;s++)e+=String.fromCharCode(n[s]);return window.btoa(e)}function Ve(i){return i.replace(/[/+=]/g,e=>({"/":"_","+":"-","=":"."})[e])}const He="solana-wallet";function ee(i){return i.replace(/(^\/+|\/+$)/g,"").split("/")}function Ye(i,e){let n=null;if(e){try{n=new URL(e)}catch{}if((n==null?void 0:n.protocol)!=="https:")throw new R(b.ERROR_FORBIDDEN_WALLET_BASE_URL,"Base URLs supplied by wallets must be valid `https` URLs")}n||(n=new URL(`${He}:/`));const t=i.startsWith("/")?i:[...ee(n.pathname),...ee(i)].join("/");return new URL(t,n)}function qe(i,e,n,t=["v1"]){return f(this,void 0,void 0,function*(){const s=le(e),o=yield crypto.subtle.exportKey("raw",i),r=Ge(o),a=Ye("v1/associate/local",n);return a.searchParams.set("association",Ve(r)),a.searchParams.set("port",`${s}`),t.forEach(y=>{a.searchParams.set("v",y)}),a})}const W={Firefox:0,Other:1};function $e(){return navigator.userAgent.indexOf("Firefox/")!==-1?W.Firefox:W.Other}function Ze(){return new Promise((i,e)=>{function n(){clearTimeout(s),window.removeEventListener("blur",t)}function t(){n(),i()}window.addEventListener("blur",t);const s=setTimeout(()=>{n(),e()},2e3)})}let L=null;function Qe(i){L==null&&(L=document.createElement("iframe"),L.style.display="none",document.body.appendChild(L)),L.contentWindow.location.href=i.toString()}function Je(i){return f(this,void 0,void 0,function*(){if(i.protocol==="https:")window.location.assign(i);else try{const e=$e();switch(e){case W.Firefox:Qe(i);break;case W.Other:{const n=Ze();window.location.assign(i),yield n;break}default:}}catch{throw new R(b.ERROR_WALLET_NOT_FOUND,"Found no installed wallet that supports the mobile wallet protocol.")}})}function Xe(i,e){return f(this,void 0,void 0,function*(){const n=Fe(),t=yield qe(i,n,e);return yield Je(t),n})}const te={retryDelayScheduleMs:[150,150,200,500,500,750,750,1e3],timeoutMs:3e4},et="com.solana.mobilewalletadapter.v1";function tt(){if(typeof window>"u"||window.isSecureContext!==!0)throw new R(b.ERROR_SECURE_CONTEXT_REQUIRED,"The mobile wallet adapter protocol must be used in a secure context (`https`).")}function nt(i){let e;try{e=new URL(i)}catch{throw new R(b.ERROR_FORBIDDEN_WALLET_BASE_URL,"Invalid base URL supplied by wallet")}if(e.protocol!=="https:")throw new R(b.ERROR_FORBIDDEN_WALLET_BASE_URL,"Base URLs supplied by wallets must be valid `https` URLs")}function ne(i){return new DataView(i).getUint32(0,!1)}function it(i,e){return f(this,void 0,void 0,function*(){tt();const n=yield We(),s=`ws://localhost:${yield Xe(n.publicKey,e==null?void 0:e.baseUri)}/solana-wallet`;let o;const r=(()=>{const l=[...te.retryDelayScheduleMs];return()=>l.length>1?l.shift():l[0]})();let a=1,y=0,d={__type:"disconnected"};return new Promise((l,c)=>{let h;const v={},A=()=>f(this,void 0,void 0,function*(){if(d.__type!=="connecting"){console.warn(`Expected adapter state to be \`connecting\` at the moment the websocket opens. Got \`${d.__type}\`.`);return}h.removeEventListener("open",A);const{associationKeypair:m}=d,g=yield F();h.send(yield k(g.publicKey,m.privateKey)),d={__type:"hello_req_sent",associationPublicKey:m.publicKey,ecdhPrivateKey:g.privateKey}}),N=m=>{m.wasClean?d={__type:"disconnected"}:c(new R(b.ERROR_SESSION_CLOSED,`The wallet session dropped unexpectedly (${m.code}: ${m.reason}).`,{closeEvent:m})),S()},C=m=>f(this,void 0,void 0,function*(){S(),Date.now()-o>=te.timeoutMs?c(new R(b.ERROR_SESSION_TIMEOUT,`Failed to connect to the wallet websocket at ${s}.`)):(yield new Promise(g=>{const U=r();P=window.setTimeout(g,U)}),q())}),M=m=>f(this,void 0,void 0,function*(){const g=yield m.data.arrayBuffer();switch(d.__type){case"connecting":if(g.byteLength!==0)throw new Error("Encountered unexpected message while connecting");const U=yield F();h.send(yield k(U.publicKey,n.privateKey)),d={__type:"hello_req_sent",associationPublicKey:n.publicKey,ecdhPrivateKey:U.privateKey};break;case"connected":try{const _=g.slice(0,O),E=ne(_);if(E!==y+1)throw new Error("Encrypted message has invalid sequence number");y=E;const T=yield xe(g,d.sharedSecret),D=v[T.id];delete v[T.id],D.resolve(T.result)}catch(_){if(_ instanceof oe){const E=v[_.jsonRpcMessageId];delete v[_.jsonRpcMessageId],E.reject(_)}else throw _}break;case"hello_req_sent":{if(g.byteLength===0){const w=yield F();h.send(yield k(w.publicKey,n.privateKey)),d={__type:"hello_req_sent",associationPublicKey:n.publicKey,ecdhPrivateKey:w.privateKey};break}const _=yield ke(g,d.associationPublicKey,d.ecdhPrivateKey),E=g.slice(re),T=E.byteLength!==0?yield f(this,void 0,void 0,function*(){const w=E.slice(0,O),I=ne(w);if(I!==y+1)throw new Error("Encrypted message has invalid sequence number");return y=I,Be(E,_)}):{protocol_version:"legacy"};d={__type:"connected",sharedSecret:_,sessionProperties:T};const D=Ne(T.protocol_version,(w,I)=>f(this,void 0,void 0,function*(){const $=a++;return h.send(yield De({id:$,jsonrpc:"2.0",method:w,params:I??{}},_)),new Promise((ue,Z)=>{v[$]={resolve(Q){switch(w){case"authorize":case"reauthorize":{const{wallet_uri_base:J}=Q;if(J!=null)try{nt(J)}catch(he){Z(he);return}break}}ue(Q)},reject:Z}})}));try{l(yield i(D))}catch(w){c(w)}finally{S(),h.close()}break}}});let S,P;const q=()=>{S&&S(),d={__type:"connecting",associationKeypair:n},o===void 0&&(o=Date.now()),h=new WebSocket(s,[et]),h.addEventListener("open",A),h.addEventListener("close",N),h.addEventListener("error",C),h.addEventListener("message",M),S=()=>{window.clearTimeout(P),h.removeEventListener("open",A),h.removeEventListener("close",N),h.removeEventListener("error",C),h.removeEventListener("message",M)}};q()})})}function G(i,e){var n={};for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&e.indexOf(t)<0&&(n[t]=i[t]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,t=Object.getOwnPropertySymbols(i);s<t.length;s++)e.indexOf(t[s])<0&&Object.prototype.propertyIsEnumerable.call(i,t[s])&&(n[t[s]]=i[t[s]]);return n}function j(i,e,n,t){function s(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function a(l){try{d(t.next(l))}catch(c){r(c)}}function y(l){try{d(t.throw(l))}catch(c){r(c)}}function d(l){l.done?o(l.value):s(l.value).then(a,y)}d((t=t.apply(i,[])).next())})}function de(i){return window.btoa(String.fromCharCode.call(null,...i))}function V(i){return new Uint8Array(window.atob(i).split("").map(e=>e.charCodeAt(0)))}function ie(i){const e="version"in i?i.serialize():i.serialize({requireAllSignatures:!1,verifySignatures:!1});return de(e)}function st(i){const n=i[0]*pe+1;return fe.deserializeMessageVersion(i.slice(n,i.length))==="legacy"?ge.from(i):_e.deserialize(i)}function ot(i,e){return j(this,void 0,void 0,function*(){return yield it(t=>{const s=new Proxy({},{get(o,r){if(o[r]==null)switch(r){case"signAndSendTransactions":o[r]=function(a){var{minContextSlot:y,commitment:d,skipPreflight:l,maxRetries:c,waitForCommitmentToSendNextTransaction:h,transactions:v}=a,A=G(a,["minContextSlot","commitment","skipPreflight","maxRetries","waitForCommitmentToSendNextTransaction","transactions"]);return j(this,void 0,void 0,function*(){const N=v.map(ie),C={min_context_slot:y,commitment:d,skip_preflight:l,max_retries:c,wait_for_commitment_to_send_next_transaction:h},{signatures:M}=yield t.signAndSendTransactions(Object.assign(Object.assign(Object.assign({},A),Object.values(C).some(P=>P!=null)?{options:C}:null),{payloads:N}));return M.map(V).map(Ae.encode)})};break;case"signMessages":o[r]=function(a){var{payloads:y}=a,d=G(a,["payloads"]);return j(this,void 0,void 0,function*(){const l=y.map(de),{signed_payloads:c}=yield t.signMessages(Object.assign(Object.assign({},d),{payloads:l}));return c.map(V)})};break;case"signTransactions":o[r]=function(a){var{transactions:y}=a,d=G(a,["transactions"]);return j(this,void 0,void 0,function*(){const l=y.map(ie),{signed_payloads:c}=yield t.signTransactions(Object.assign(Object.assign({},d),{payloads:l}));return c.map(V).map(st)})};break;default:{o[r]=t[r];break}}return o[r]},defineProperty(){return!1},deleteProperty(){return!1}});return i(s)},e)})}function u(i,e,n,t){function s(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function a(l){try{d(t.next(l))}catch(c){r(c)}}function y(l){try{d(t.throw(l))}catch(c){r(c)}}function d(l){l.done?o(l.value):s(l.value).then(a,y)}d((t=t.apply(i,[])).next())})}function K(i){return new Uint8Array(window.atob(i).split("").map(e=>e.charCodeAt(0)))}function rt(){return typeof window<"u"&&window.isSecureContext&&typeof document<"u"&&/android/i.test(navigator.userAgent)}const at="Mobile Wallet Adapter",ct=64;function lt(i){const e=K(i);return new be(e)}function se(i){return"version"in i}function dt(i){switch(i){case"mainnet-beta":return"solana:mainnet";case"testnet":return"solana:testnet";case"devnet":return"solana:devnet"}}class gt extends me{constructor(e){var n;super(),this.supportedTransactionVersions=new Set(["legacy",0]),this.name=at,this.url="https://solanamobile.com/wallets",this.icon="data:image/svg+xml;base64,PHN2ZyBmaWxsPSJub25lIiBoZWlnaHQ9IjI4IiB3aWR0aD0iMjgiIHZpZXdCb3g9Ii0zIDAgMjggMjgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iI0RDQjhGRiI+PHBhdGggZD0iTTE3LjQgMTcuNEgxNXYyLjRoMi40di0yLjRabTEuMi05LjZoLTIuNHYyLjRoMi40VjcuOFoiLz48cGF0aCBkPSJNMjEuNiAzVjBoLTIuNHYzaC0zLjZWMGgtMi40djNoLTIuNHY2LjZINC41YTIuMSAyLjEgMCAxIDEgMC00LjJoMi43VjNINC41QTQuNSA0LjUgMCAwIDAgMCA3LjVWMjRoMjEuNnYtNi42aC0yLjR2NC4ySDIuNFYxMS41Yy41LjMgMS4yLjQgMS44LjVoNy41QTYuNiA2LjYgMCAwIDAgMjQgOVYzaC0yLjRabTAgNS43YTQuMiA0LjIgMCAxIDEtOC40IDBWNS40aDguNHYzLjNaIi8+PC9nPjwvc3ZnPg==",this._connecting=!1,this._connectionGeneration=0,this._readyState=rt()?p.Loadable:p.Unsupported,this._authorizationResultCache=e.authorizationResultCache,this._addressSelector=e.addressSelector,this._appIdentity=e.appIdentity,this._chain=(n=e.chain)!==null&&n!==void 0?n:dt(e.cluster),this._hostAuthority=e.remoteHostAuthority,this._onWalletNotFound=e.onWalletNotFound,this._readyState!==p.Unsupported&&this._authorizationResultCache.get().then(t=>{t&&this.declareWalletAsInstalled()})}get publicKey(){if(this._publicKey==null&&this._selectedAddress!=null)try{this._publicKey=lt(this._selectedAddress)}catch(e){throw new ve(e instanceof Error&&(e==null?void 0:e.message)||"Unknown error",e)}return this._publicKey?this._publicKey:null}get connected(){return!!this._authorizationResult}get connecting(){return this._connecting}get readyState(){return this._readyState}declareWalletAsInstalled(){this._readyState!==p.Installed&&this.emit("readyStateChange",this._readyState=p.Installed)}runWithGuard(e){return u(this,void 0,void 0,function*(){try{return yield e()}catch(n){throw this.emit("error",n),n}})}autoConnect_DO_NOT_USE_OR_YOU_WILL_BE_FIRED(){return u(this,void 0,void 0,function*(){return yield this.autoConnect()})}autoConnect(){return u(this,void 0,void 0,function*(){if(!(this.connecting||this.connected))return yield this.runWithGuard(()=>u(this,void 0,void 0,function*(){if(this._readyState!==p.Installed&&this._readyState!==p.Loadable)throw new x;this._connecting=!0;try{const e=yield this._authorizationResultCache.get();e&&this.handleAuthorizationResult(e)}catch(e){throw new z(e instanceof Error&&e.message||"Unknown error",e)}finally{this._connecting=!1}}))})}connect(){return u(this,void 0,void 0,function*(){if(!(this.connecting||this.connected))return yield this.runWithGuard(()=>u(this,void 0,void 0,function*(){if(this._readyState!==p.Installed&&this._readyState!==p.Loadable)throw new x;this._connecting=!0;try{yield this.performAuthorization()}catch(e){throw new z(e instanceof Error&&e.message||"Unknown error",e)}finally{this._connecting=!1}}))})}performAuthorization(e){return u(this,void 0,void 0,function*(){try{const n=yield this._authorizationResultCache.get();return n?(this.handleAuthorizationResult(n),n):yield this.transact(t=>u(this,void 0,void 0,function*(){const s=yield t.authorize({chain:this._chain,identity:this._appIdentity,sign_in_payload:e});return Promise.all([this._authorizationResultCache.set(s),this.handleAuthorizationResult(s)]),s}))}catch(n){throw new z(n instanceof Error&&n.message||"Unknown error",n)}})}handleAuthorizationResult(e){var n;return u(this,void 0,void 0,function*(){const t=this._authorizationResult==null||((n=this._authorizationResult)===null||n===void 0?void 0:n.accounts.length)!==e.accounts.length||this._authorizationResult.accounts.some((s,o)=>s.address!==e.accounts[o].address);if(this._authorizationResult=e,this.declareWalletAsInstalled(),t){const s=yield this._addressSelector.select(e.accounts.map(({address:o})=>o));s!==this._selectedAddress&&(this._selectedAddress=s,delete this._publicKey,this.emit("connect",this.publicKey))}})}performReauthorization(e,n){return u(this,void 0,void 0,function*(){try{const t=yield e.authorize({auth_token:n,identity:this._appIdentity});Promise.all([this._authorizationResultCache.set(t),this.handleAuthorizationResult(t)])}catch(t){throw this.disconnect(),new Re(t instanceof Error&&(t==null?void 0:t.message)||"Unknown error",t)}})}disconnect(){return u(this,void 0,void 0,function*(){this._authorizationResultCache.clear(),this._connecting=!1,this._connectionGeneration++,delete this._authorizationResult,delete this._publicKey,delete this._selectedAddress,this.emit("disconnect")})}transact(e){var n;return u(this,void 0,void 0,function*(){const t=(n=this._authorizationResult)===null||n===void 0?void 0:n.wallet_uri_base,s=t?{baseUri:t}:void 0,o=this._hostAuthority?{remoteHostAuthority:this._hostAuthority}:void 0,r=this._connectionGeneration;try{return yield ot(e,Object.assign(Object.assign({},s),o))}catch(a){throw this._connectionGeneration!==r&&(yield new Promise(()=>{})),a instanceof Error&&a.name==="SolanaMobileWalletAdapterError"&&a.code==="ERROR_WALLET_NOT_FOUND"&&(yield this._onWalletNotFound(this)),a}})}assertIsAuthorized(){if(!this._authorizationResult||!this._selectedAddress)throw new we;return{authToken:this._authorizationResult.auth_token,selectedAddress:this._selectedAddress}}performSignTransactions(e){return u(this,void 0,void 0,function*(){const{authToken:n}=this.assertIsAuthorized();try{return yield this.transact(t=>u(this,void 0,void 0,function*(){return yield this.performReauthorization(t,n),yield t.signTransactions({transactions:e})}))}catch(t){throw new Ee(t==null?void 0:t.message,t)}})}sendTransaction(e,n,t){return u(this,void 0,void 0,function*(){return yield this.runWithGuard(()=>u(this,void 0,void 0,function*(){const{authToken:s}=this.assertIsAuthorized(),o=t==null?void 0:t.minContextSlot;try{return yield this.transact(r=>u(this,void 0,void 0,function*(){function a(){let c;switch(n.commitment){case"confirmed":case"finalized":case"processed":c=n.commitment;break;default:c="finalized"}let h;switch(t==null?void 0:t.preflightCommitment){case"confirmed":case"finalized":case"processed":h=t.preflightCommitment;break;case void 0:h=c;break;default:h="finalized"}return(h==="finalized"?2:h==="confirmed"?1:0)<(c==="finalized"?2:c==="confirmed"?1:0)?h:c}const[y,d,l]=yield Promise.all([r.getCapabilities(),this.performReauthorization(r,s),se(e)?null:u(this,void 0,void 0,function*(){var c;if(e.feePayer||(e.feePayer=(c=this.publicKey)!==null&&c!==void 0?c:void 0),e.recentBlockhash==null){const{blockhash:h}=yield n.getLatestBlockhash({commitment:a()});e.recentBlockhash=h}})]);if(y.supports_sign_and_send_transactions)return(yield r.signAndSendTransactions({minContextSlot:o,transactions:[e]}))[0];{const[c]=yield r.signTransactions({transactions:[e]});if(se(c))return yield n.sendTransaction(c);{const h=c.serialize();return yield n.sendRawTransaction(h,Object.assign(Object.assign({},t),{preflightCommitment:a()}))}}}))}catch(r){throw new Se(r==null?void 0:r.message,r)}}))})}signTransaction(e){return u(this,void 0,void 0,function*(){return yield this.runWithGuard(()=>u(this,void 0,void 0,function*(){const[n]=yield this.performSignTransactions([e]);return n}))})}signAllTransactions(e){return u(this,void 0,void 0,function*(){return yield this.runWithGuard(()=>u(this,void 0,void 0,function*(){return yield this.performSignTransactions(e)}))})}signMessage(e){return u(this,void 0,void 0,function*(){return yield this.runWithGuard(()=>u(this,void 0,void 0,function*(){const{authToken:n,selectedAddress:t}=this.assertIsAuthorized();try{return yield this.transact(s=>u(this,void 0,void 0,function*(){yield this.performReauthorization(s,n);const[o]=yield s.signMessages({addresses:[t],payloads:[e]});return o.slice(-ct)}))}catch(s){throw new Oe(s==null?void 0:s.message,s)}}))})}signIn(e){return u(this,void 0,void 0,function*(){return yield this.runWithGuard(()=>u(this,void 0,void 0,function*(){var n,t;if(this._readyState!==p.Installed&&this._readyState!==p.Loadable)throw new x;this._connecting=!0;try{const s=yield this.performAuthorization(Object.assign(Object.assign({},e),{domain:(n=e==null?void 0:e.domain)!==null&&n!==void 0?n:window.location.host}));if(!s.sign_in_result)throw new Error("Sign in failed, no sign in result returned by wallet");const o=s.sign_in_result.address;return{account:Object.assign(Object.assign({},(t=s.accounts.find(a=>a.address==o))!==null&&t!==void 0?t:{address:o}),{publicKey:K(o)}),signedMessage:K(s.sign_in_result.signed_message),signature:K(s.sign_in_result.signature)}}catch(s){throw new z(s instanceof Error&&s.message||"Unknown error",s)}finally{this._connecting=!1}}))})}}function _t(){return{select(i){return u(this,void 0,void 0,function*(){return i[0]})}}}const H="SolanaMobileWalletAdapterDefaultAuthorizationCache";function pt(){let i;try{i=window.localStorage}catch{}return{clear(){return u(this,void 0,void 0,function*(){if(i)try{i.removeItem(H)}catch{}})},get(){return u(this,void 0,void 0,function*(){if(i)try{return JSON.parse(i.getItem(H))||void 0}catch{}})},set(e){return u(this,void 0,void 0,function*(){if(i)try{i.setItem(H,JSON.stringify(e))}catch{}})}}}function ut(i){return u(this,void 0,void 0,function*(){typeof window<"u"&&window.location.assign(i.url)})}function mt(){return ut}export{at as S,gt as a,pt as b,mt as c,_t as d};
